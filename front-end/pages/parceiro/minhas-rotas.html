<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minhas Rotas - Dashboard Parceiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="style/parceiro/minhas-rotas.css">
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <!-- INSERIR LOGO AQUI -->
                <!-- Exemplo: <img src="/images/logo.png" alt="Logo da Empresa" /> -->
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="dashboard-parceiros.html">
                            <img src="https://img.icons8.com/ios-filled/24/ffffff/speedometer.png"
                                alt="Dashboard Icon" />
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="minhas-rotas.html" class="active">
                            <img src="https://img.icons8.com/ios-filled/24/ffffff/route.png" alt="Rotas Icon" />
                            Minhas Rotas
                        </a>
                    </li>
                    <li>
                        <a href="configuracoes-parceiros.html">
                            <img src="https://img.icons8.com/ios-filled/24/ffffff/settings.png"
                                alt="Configurações Icon" />
                            Configurações
                        </a>
                    </li>
                    <li>
                        <a href="login-parceiros.html">
                            <img src="https://img.icons8.com/ios-filled/24/ffffff/exit.png" alt="Sair Icon" />
                            Sair
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="header-top">
                <div class="hamburger-menu" id="hamburgerMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <h1>Minhas Rotas</h1>
                <div class="user-menu">
                    <img src="https://img.icons8.com/ios-filled/32/user-male-circle.png" alt="Profile Icon" />
                    <img src="https://img.icons8.com/ios-filled/32/settings.png" alt="Settings Icon" />
                </div>
            </div>

            <div class="search-filter-bar">
                <input type="search" id="searchRoutes" placeholder="Buscar rotas por nome..." />
                <select id="filterStatus">
                    <option value="all">Todos os Status</option>
                    <option value="active">Ativo</option>
                    <option value="paused">Pausado</option>
                    <option value="draft">Rascunho</option>
                    <option value="pending">Pendente</option>
                </select>
                <button onclick="location.href='criar-rota.html'">Nova Rota</button>
            </div>

            <div class="table-container">
                <table class="routes-table">
                    <thead>
                        <tr>
                            <th>Nome da Rota</th>
                            <th>Status</th>
                            <th>Criada em</th>
                            <th>Avaliação</th>
                            <th>Visualizações</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="routesTableBody">
                        <!-- Dados das rotas serão inseridos aqui pelo JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <button id="prevPage" disabled>Anterior</button>
                <span id="currentPage">1</span> / <span id="totalPages">1</span>
                <button id="nextPage">Próxima</button>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.getElementById("sidebar");
            const hamburgerMenu = document.getElementById("hamburgerMenu");
            const routesTableBody = document.getElementById("routesTableBody");
            const searchRoutesInput = document.getElementById("searchRoutes");
            const filterStatusSelect = document.getElementById("filterStatus");
            const prevPageBtn = document.getElementById("prevPage");
            const nextPageBtn = document.getElementById("nextPage");
            const currentPageSpan = document.getElementById("currentPage");
            const totalPagesSpan = document.getElementById("totalPages");

            // Sample Data (replace with actual data from backend)
            let allRoutes = [
                {
                    id: 1,
                    name: "Rota Histórica de Olinda",
                    status: "active",
                    created: "2023-01-15",
                    rating: 4.8,
                    views: 1250,
                },
                {
                    id: 2,
                    name: "Trilhas Ecológicas de Fernando de Noronha",
                    status: "paused",
                    created: "2023-03-20",
                    rating: 4.5,
                    views: 890,
                },
                {
                    id: 3,
                    name: "Gastronomia Recifense: Sabores Locais",
                    status: "draft",
                    created: "2023-05-01",
                    rating: 0,
                    views: 50,
                },
                {
                    id: 4,
                    name: "Passeio de Catamarã pelo Rio Capibaribe",
                    status: "active",
                    created: "2023-06-10",
                    rating: 4.9,
                    views: 2100,
                },
                {
                    id: 5,
                    name: "Roteiro Cultural do Bairro do Recife",
                    status: "pending",
                    created: "2023-07-01",
                    rating: 4.2,
                    views: 320,
                },
                {
                    id: 6,
                    name: "Praias do Litoral Sul: Calhetas e Muro Alto",
                    status: "active",
                    created: "2023-08-05",
                    rating: 4.7,
                    views: 1500,
                },
                {
                    id: 7,
                    name: "Arte Urbana em Boa Vista",
                    status: "draft",
                    created: "2023-09-12",
                    rating: 0,
                    views: 80,
                },
                {
                    id: 8,
                    name: "Mercado de São José: Tradição e Artesanato",
                    status: "active",
                    created: "2023-10-01",
                    rating: 4.6,
                    views: 980,
                },
                {
                    id: 9,
                    name: "Cachaçarias e Engenhos de Pernambuco",
                    status: "paused",
                    created: "2023-11-11",
                    rating: 4.3,
                    views: 670,
                },
                {
                    id: 10,
                    name: "Carnaval de Olinda: Frevo e Ladeiras",
                    status: "active",
                    created: "2023-12-01",
                    rating: 5.0,
                    views: 3000,
                },
                {
                    id: 11,
                    name: "Museu Cais do Sertão",
                    status: "active",
                    created: "2024-01-05",
                    rating: 4.7,
                    views: 750,
                },
                {
                    id: 12,
                    name: "Capela Dourada e Convento de Santo Antônio",
                    status: "pending",
                    created: "2024-02-10",
                    rating: 4.1,
                    views: 280,
                },
                {
                    id: 13,
                    name: "Polo Gastronômico de Casa Forte",
                    status: "draft",
                    created: "2024-03-01",
                    rating: 0,
                    views: 60,
                },
                {
                    id: 14,
                    name: "Praia de Boa Viagem: Coqueiros e Piscinas Naturais",
                    status: "active",
                    created: "2024-04-15",
                    rating: 4.9,
                    views: 1800,
                },
                {
                    id: 15,
                    name: "Centro de Artesanato de Pernambuco",
                    status: "active",
                    created: "2024-05-01",
                    rating: 4.5,
                    views: 920,
                },
            ];

            let filteredRoutes = [...allRoutes];
            let currentPage = 1;
            const rowsPerPage = 5;

            // Hamburger menu toggle
            hamburgerMenu.addEventListener("click", () => {
                sidebar.classList.toggle("active");
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener("click", (event) => {
                if (
                    window.innerWidth <= 768 &&
                    sidebar.classList.contains("active") &&
                    !sidebar.contains(event.target) &&
                    !hamburgerMenu.contains(event.target)
                ) {
                    sidebar.classList.remove("active");
                }
            });

            function getStatusBadge(status) {
                let className = "";
                let text = "";
                switch (status) {
                    case "active":
                        className = "active";
                        text = "Ativo";
                        break;
                    case "paused":
                        className = "paused";
                        text = "Pausado";
                        break;
                    case "draft":
                        className = "draft";
                        text = "Rascunho";
                        break;
                    case "pending":
                        className = "pending";
                        text = "Pendente";
                        break;
                    default:
                        className = "draft";
                        text = "Desconhecido";
                }
                return `<span class="status-badge ${className}">${text}</span>`;
            }

            function renderTable() {
                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                const paginatedRoutes = filteredRoutes.slice(start, end);

                routesTableBody.innerHTML = "";
                if (paginatedRoutes.length === 0) {
                    routesTableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 20px;">Nenhuma rota encontrada.</td></tr>`;
                    prevPageBtn.disabled = true;
                    nextPageBtn.disabled = true;
                    currentPageSpan.textContent = 0;
                    totalPagesSpan.textContent = 0;
                    return;
                }

                paginatedRoutes.forEach((route) => {
                    const row = routesTableBody.insertRow();
                    row.innerHTML = `
              <td>${route.name}</td>
              <td>${getStatusBadge(route.status)}</td>
              <td>${route.created}</td>
              <td>${route.rating > 0 ? route.rating.toFixed(1) : "N/A"}</td>
              <td>${route.views}</td>
              <td class="actions">
                <button onclick="editRoute(${route.id})">Editar</button>
                <button onclick="duplicateRoute(${route.id})">Duplicar</button>
                <button class="delete" onclick="deleteRoute(${route.id})">Deletar</button>
              </td>
            `;
                });

                updatePaginationControls();
            }

            function updatePaginationControls() {
                const totalPages = Math.ceil(filteredRoutes.length / rowsPerPage);
                currentPageSpan.textContent = filteredRoutes.length === 0 ? 0 : currentPage;
                totalPagesSpan.textContent = totalPages;

                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages || filteredRoutes.length === 0;
            }

            function applyFilters() {
                const searchTerm = searchRoutesInput.value.toLowerCase();
                const statusFilter = filterStatusSelect.value;

                filteredRoutes = allRoutes.filter((route) => {
                    const matchesSearch = route.name.toLowerCase().includes(searchTerm);
                    const matchesStatus =
                        statusFilter === "all" || route.status === statusFilter;
                    return matchesSearch && matchesStatus;
                });

                currentPage = 1; // Reset to first page after filtering
                renderTable();
            }

            // Event Listeners for search and filter
            searchRoutesInput.addEventListener("input", applyFilters);
            filterStatusSelect.addEventListener("change", applyFilters);

            // Pagination event listeners
            prevPageBtn.addEventListener("click", () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            });

            nextPageBtn.addEventListener("click", () => {
                const totalPages = Math.ceil(filteredRoutes.length / rowsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            });

            // Initial render
            applyFilters(); // Call applyFilters to render initial table and set pagination

            // Global functions for table actions (for simplicity, use alerts)
            window.editRoute = (id) => {
                alert(`Editar rota com ID: ${id}`);
                // Implement navigation to edit page or modal
            };

            window.duplicateRoute = (id) => {
                alert(`Duplicar rota com ID: ${id}`);
                // Implement logic to create a copy of the route
            };

            window.deleteRoute = (id) => {
                if (confirm(`Tem certeza que deseja deletar a rota com ID: ${id}?`)) {
                    allRoutes = allRoutes.filter((route) => route.id !== id);
                    applyFilters(); // Re-apply filters to update table and pagination
                    alert(`Rota com ID ${id} deletada.`);
                }
            };
        });
    </script>
</body>

</html>